<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="csrf-token" content="{{ csrf_token }}" />
    {% load static %}

    <!-- HTML Meta Tags -->
    <title>Tidder</title>
    <meta name="description" content="Reddit Clone">

    <!-- Facebook Meta Tags -->
    <meta property="og:url" content="https://complete-tick-cleanly.ngrok-free.app">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Tidder">
    <meta property="og:description" content="Reddit Clone">
    <meta property="og:image" content="https://opengraph.b-cdn.net/production/images/25785e68-de73-4761-b85d-d851e46e7e07.png?token=Cxtyc7nIE5T6XMeyCxNeai8tR6vjyQq2kJJhaDTHLfk&height=240&width=240&expires=33267304195">

    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta property="twitter:domain" content="complete-tick-cleanly.ngrok-free.app">
    <meta property="twitter:url" content="https://complete-tick-cleanly.ngrok-free.app">
    <meta name="twitter:title" content="Tidder">
    <meta name="twitter:description" content="Reddit Clone">
    <meta name="twitter:image" content="https://opengraph.b-cdn.net/production/images/25785e68-de73-4761-b85d-d851e46e7e07.png?token=Cxtyc7nIE5T6XMeyCxNeai8tR6vjyQq2kJJhaDTHLfk&height=240&width=240&expires=33267304195">


    <script src="{% static 'js/tailwind.js'%}"></script>

    <!-- Flowbite -->
    <link rel="stylesheet" href="{% static 'css/flowbite.min.css'%}" />
    <script src="{% static 'js/flowbite.min.js'%}"></script>

    <!-- Toast -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    {% block quill %} {% endblock %}

    <script>
      // On page load or when changing themes, best to add inline in `head` to avoid FOUC
      if (
        localStorage.getItem("color-theme") === "dark" ||
        (!("color-theme" in localStorage) &&
          window.matchMedia("(prefers-color-scheme: dark)").matches)
      ) {
        document.documentElement.classList.add("dark");
      } else {
        document.documentElement.classList.remove("dark");
      }
    </script>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
                dark_1: "#0E1113",
              dark_2: "#05090B",
              dark_3: "#101214",
              dark_4: "#333D42",
              dark_5: "#161A1D",
              dark_6: "#181C1F",
              gray_1: "#3C4244",
              gray_2: "#2B3336",
              gray_3: "#ffffff33",
              gray_4: "#A2A2A5",
              white_1: "#F3F3F2",
              white_2: "#717981",
              white_3: "#889375",
              white_4: "#F7F9F9",
              button_red: "#C82C00",
              button_red_hover: "#A61F00",
              button_gray: "#E5EBEE",
              button_gray_hover: "#DDE3E6",
              button_blue: "#0A449B",
              button_blue_hover: "#0A2F6C",
              txt_color_1: "#131212",
              txt_color_2: "#33363B",
              txt_color_3: "#697075",
              bg_1: "#F5F4F6",
            },
            keyframes: {
              slideIn: {
                '0%': { opacity: '0', transform: 'translateX(100%)' },
                '100%': { opacity: '1', transform: 'translateX(0)' },
              },
            },
            animation: {
              slideIn: 'slideIn 0.3s ease-out forwards',
            },
          },
        },
        darkMode: "class",
      };
    </script>
    {% block extra_head %}{% endblock %}
  </head>

  <body class="transition-colors dark:bg-dark_1 dark:text-white">
    {% include 'components/navbar.html'%}

    <script>
      function uuidv4() {
        return "10000000-1000-4000-8000-100000000000".replace(/[018]/g, (c) =>
          (
            +c ^
            (crypto.getRandomValues(new Uint8Array(1))[0] & (15 >> (+c / 4)))
          ).toString(16),
        );
      }
      function validateEmail(email) {
        const emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
        return emailPattern.test(email);
      }

      function setupRemoveFilePreview(
        button,
        previewElement,
        previewContainer,
        fileInput,
        fileInputContainer,
      ) {
        button.addEventListener("click", () => {
          if (previewContainer) {
            previewContainer.classList.add("hidden");
          }
          if (fileInputContainer) {
            fileInputContainer.classList.remove("hidden");
          }
          if (previewElement) {
            previewElement.src = "";
          }
          fileInput.value = "";
        });
      }

      function setupFileInput(
        previewElement,
        previewContainer,
        fileInput,
        fileInputContainer,
      ) {
        fileInput.addEventListener("change", function (event) {
          var file = event.target.files[0];
          if (file) {
            var reader = new FileReader();
            reader.onload = function (e) {
              previewElement.src = e.target.result;
              fileInputContainer.classList.add("hidden");
              previewContainer.classList.remove("hidden");
            };
            reader.readAsDataURL(file);
          }
        });
      }

      function getCSRFToken() {
        return document
          .querySelector('meta[name="csrf-token"]')
          .getAttribute("content");
      }

      function remove_class(document, class_name) {
        document.classList.remove(class_name);
      }

      function add_class(document, class_name) {
        document.classList.add(class_name);
      }

      function showTab(
        n,
        class_name,
        prev_button_id,
        next_button_id,
        step_class_name,
      ) {
        var x = document.getElementsByClassName(class_name);
        x[n].classList.remove("hidden");

        const prevBtn = document.getElementById(prev_button_id);
        const nextBtn = document.getElementById(next_button_id);

        if (n == 0) {
          prevBtn.classList.add("hidden");
        } else {
          prevBtn.classList.remove("hidden");
        }

        if (n == x.length - 1) {
          nextBtn.innerHTML = "Submit";
        } else {
          nextBtn.innerHTML = "Next";
        }
        if (step_class_name != null) {
          fixStepIndicator(n, step_class_name);
        }
      }

      // OPTIONAL
      function fixStepIndicator(n, step_class_name) {
        var i,
          x = document.getElementsByClassName(step_class_name);
        for (i = 0; i < x.length; i++) {
          x[i].className = x[i].className.replace(" active", "");
        }
        x[n].className += " active";
      }

      async function validate_form(
        tab_class_name,
        form_specific_validation_function,
        current_tab,
        step_class_name,
      ) {
        var x,
          y,
          i,
          valid = true;
        x = document.getElementsByClassName(tab_class_name);
        y = x[current_tab].getElementsByTagName("input");
        for (i = 0; i < y.length; i++) {
          current_valid = true;
          if (y[i].classList.contains("optional")) {
            continue;
          }
          if (y[i].value == "") {
            y[i].classList.add("ring-1", "ring-red-500", "ring-inset");
            valid = false;
            current_valid = false;
          }

          if (form_specific_validation_function != null) {
            const result = await form_specific_validation_function(
              valid,
              current_valid,
              y,
              i,
            );
            valid = result[0];
            current_valid = result[1];
          }

          if (current_valid) {
            y[i].classList.remove("ring-1", "ring-red-500", "ring-inset");
          }
        }

        if (valid && step_class_name != null) {
          document.getElementsByClassName(step_class_name)[
            current_tab
          ].className += " finish";
        }
        return valid;
      }

      async function nextPrev(
        n,
        form_specific_validation_function,
        tab_class_name,
        form_id,
        prev_button_id,
        next_button_id,
        step_class_name,
        current_tab,
      ) {
        var x = document.getElementsByClassName(tab_class_name);
        if (
          n == 1 &&
          !(await validate_form(
            tab_class_name,
            form_specific_validation_function,
            current_tab,
            step_class_name,
          ))
        )
          return current_tab;

        x[current_tab].classList.add("hidden");
        current_tab = current_tab + n;

        if (current_tab >= x.length) {
          x[x.length - 1].classList.remove("hidden");
          document.getElementById(form_id).submit();
          nextBtn.disabled = true;
          return false;
        }
        showTab(
          current_tab,
          tab_class_name,
          prev_button_id,
          next_button_id,
          step_class_name,
        );
        return current_tab;
      }

      function parseDateString(dateString) {
        const [month, day, year, time, period] = dateString.split(/[\s,]+/);
        const months = {
          "Jan.": 0,
          "Feb.": 1,
          "Mar.": 2,
          "Apr.": 3,
          "May": 4,
          "Jun.": 5,
          "Jul.": 6,
          "Aug.": 7,
          "Sept.": 8,
          "Oct.": 9,
          "Nov.": 10,
          "Dec.": 11,
        };
        const [hours, minutes] = time.split(":").map(Number);
        const adjustedHours =
          period === "p.m." && hours !== 12
            ? hours + 12
            : period === "a.m." && hours === 12
              ? 0
              : hours;

        const utcDate = new Date(
          Date.UTC(year, months[month], day, adjustedHours, minutes),
        );

        return utcDate;
      }

      function timeAgo(datetime) {
        const currentDate = new Date();
        const createdAt = new Date(parseDateString(datetime));
        const timeDifference = currentDate.getTime() - createdAt.getTime();

        const minute = 60 * 1000;
        const hour = minute * 60;
        const day = hour * 24;
        const month = day * 30;
        const year = day * 365;

        if (timeDifference < minute) {
          return "Just now";
        } else if (timeDifference < hour) {
          const minutes = Math.floor(timeDifference / minute);
          return `${minutes} min. ago`;
        } else if (timeDifference < day) {
          const hours = Math.floor(timeDifference / hour);
          return `${hours} hr. ago`;
        } else if (timeDifference < month) {
          const days = Math.floor(timeDifference / day);
          return `${days} day${days > 0 ? "s" : ""} ago`;
        } else if (timeDifference < year) {
          const months = Math.floor(timeDifference / month);
          return `${months} mon. ago`;
        } else {
          const years = Math.floor(timeDifference / year);
          return `${years} yr. ago`;
        }
      }

      function openModal(modalId) {
        document.getElementById(modalId).classList.remove("hidden");
      }

      function closeModal(modalId) {
        document.getElementById(modalId).classList.add("hidden");
      }

      function populate_values(elements, values) {
        for (let i = 0; i < elements.length; i++) {
          const element = document.getElementById(elements[i]);
          if (element.tagName === "INPUT") {
            element.value = values[i];
          } else {
            element.textContent = values[i];
          }
        }
      }

      function addRecentPost(post_id, post_title, post_content){
        let recent_posts = localStorage.getItem("recent_posts");
        if(recent_posts == null){
            recent_posts = [];
        }else{
            recent_posts = JSON.parse(recent_posts);
        }
        const postExists = recent_posts.some(post => post.post_id === post_id);
        if (!postExists) {
            let post = { post_id, post_title, post_content };
            recent_posts.unshift(post);
            if(recent_posts.length > 10){
                recent_posts.pop();
            }
            localStorage.setItem("recent_posts", JSON.stringify(recent_posts));
            addRecentPostItem(post);
        }
      };

      function addRecentPostItem(post){
        const recentPostsContainer = document.getElementById("recent_posts");
        const recentPostItem = document.createElement("div");
        recentPostItem.classList.add("recent_post_item", "max-h-[55px]", "line-clamp-2", "border-b", "border-gray-300", "py-2");
        recentPostItem.classList.add("recent_post_item");
        recentPostItem.innerHTML = `
            <a href="/post/${post.post_id}">
                <p class="font-bold">${post.post_title}</p>
                ${post.post_content}
            </a>
        `;
        recentPostItem.querySelectorAll("p")[1].classList.add("text-xs", "line-clamp-1");
        recentPostsContainer.prepend(recentPostItem);
      }

      function clearRecentPost(){
        localStorage.removeItem("recent_posts");
        const recentPostsContainer = document.getElementById("recent_posts");
        recentPostsContainer.innerHTML = "";
      }


      function warningToast(message) {
        const toast = document.createElement("div");
        toast.classList.add("fixed", "top-3", "right-3", "z-50", "animate-slideIn");
        toast.innerHTML += `
        <div id="toast-danger" class="flex items-center w-full max-w-xs p-4 mb-4 text-gray-500 bg-white rounded-lg shadow dark:text-gray-400 dark:bg-gray-800" role="alert">
            <div class="inline-flex items-center justify-center flex-shrink-0 w-8 h-8 text-red-500 bg-red-100 rounded-lg dark:bg-red-800 dark:text-red-200">
                <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5Zm3.707 11.793a1 1 0 1 1-1.414 1.414L10 11.414l-2.293 2.293a1 1 0 0 1-1.414-1.414L8.586 10 6.293 7.707a1 1 0 0 1 1.414-1.414L10 8.586l2.293-2.293a1 1 0 0 1 1.414 1.414L11.414 10l2.293 2.293Z"/>
                </svg>
                <span class="sr-only">Error icon</span>
            </div>
            <div class="ms-3 text-sm font-normal">${message}</div>
            <button type="button" class="ms-auto -mx-1.5 -my-1.5 bg-white text-gray-400 hover:text-gray-900 rounded-lg focus:ring-2 focus:ring-gray-300 p-1.5 hover:bg-gray-100 inline-flex items-center justify-center h-8 w-8 dark:text-gray-500 dark:hover:text-white dark:bg-gray-800 dark:hover:bg-gray-700" data-dismiss-target="#toast-danger" aria-label="Close">
                <span class="sr-only">Close</span>
                <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                </svg>
            </button>
        </div>
        `
        document.body.appendChild(toast);
        setTimeout(() => {
            toast.remove();
        }, 2000);
      }

      document.addEventListener("DOMContentLoaded", function () {
        const createdAtElements =
          document.querySelectorAll("[data-created-at]");
        for (const createdAtElement of createdAtElements) {
          const createdAt = createdAtElement.getAttribute("data-created-at");
          createdAtElement.textContent = timeAgo(createdAt);
        }

        const postContents = document.querySelectorAll(".post-content");
        postContents.forEach((postContent) => {
            postContent.innerHTML = postContent.textContent;
            postContent.classList.add("line-clamp-50", "overflow-hidden", "text-ellipsis");
        });
        const postImages = document.querySelectorAll(".post-content img");
        postImages.forEach((postImage) => {
            postImage.classList.add("max-w-[300px]");
        });

        const recentPosts = localStorage.getItem("recent_posts");
        if(recentPosts){
            const recentPostsArray = JSON.parse(recentPosts);
            const recentPostsContainer = document.getElementById("recent_posts");
            recentPostsArray.reverse().forEach(post => {
                addRecentPostItem(post);
            });
        }
      });

    </script>

    {% block content %} {% endblock %}
  </body>
</html>