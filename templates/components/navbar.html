{% load static %} {% load utils %}
<nav
  class="text-md bg-white_1 dark:bg-dark_3 dark:border-gray_1 fixed left-0 top-0 z-20 flex h-[10vh] w-full flex-row items-center justify-between border-b p-3 px-6 shadow-md"
>
  <div class="flex flex-row items-center gap-2">
    <a
      href="{% url 'account:dashboard' %}"
      class="flex flex-row items-center gap-1 text-2xl font-bold"
    >
      <svg
        class="text-black"
        width="35"
        height="28"
        viewBox="0 0 37 30"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M34.4627 6H30.8523V19.5H7.38474V22.5C7.38474 23.325 8.19708 24 9.18994 24H29.0471L36.2679 30V7.5C36.2679 6.675 35.4556 6 34.4627 6ZM27.2419 15V1.5C27.2419 0.675 26.4296 0 25.4367 0H1.96914C0.976281 0 0.16394 0.675 0.16394 1.5V22.5L7.38474 16.5H25.4367C26.4296 16.5 27.2419 15.825 27.2419 15Z"
          class="fill-black dark:fill-white"
        />
      </svg>
      Tidder
    </a>
  </div>
  {% include 'components/search.html' %}

  <div class="relative flex flex-row items-center gap-5">
    {% if user.is_authenticated %}

    <a href="{% url 'post:submit' %}" class="flex flex-row items-center gap-1">
      <svg
        class="h-4 w-4"
        fill="currentColor"
        viewBox="0 0 20 20"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M19 9.375h-8.375V1h-1.25v8.375H1v1.25h8.375V19h1.25v-8.375H19v-1.25Z"
        ></path>
      </svg>
      <h1>Create</h1>
    </a>

    <!-- <button>
      <svg
        class="h-5 w-5"
        fill="currentColor"
        viewBox="0 0 20 20"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M11 18h1a2 2 0 0 1-4 0h3Zm8-3.792v.673A1.12 1.12 0 0 1 17.883 16H2.117A1.12 1.12 0 0 1 1 14.881v-.673a3.947 3.947 0 0 1 1.738-3.277A2.706 2.706 0 0 0 3.926 8.7V7.087a6.07 6.07 0 0 1 12.138 0l.01 1.613a2.7 2.7 0 0 0 1.189 2.235A3.949 3.949 0 0 1 19 14.208Zm-1.25 0a2.7 2.7 0 0 0-1.188-2.242A3.956 3.956 0 0 1 14.824 8.7V7.088a4.819 4.819 0 1 0-9.638 0v1.615a3.956 3.956 0 0 1-1.738 3.266 2.7 2.7 0 0 0-1.198 2.239v.542h15.5v-.542Z"
        ></path>
      </svg>
    </button> -->

    <button
      id="btn_drop_down_profile"
      class="h-[30px] w-[30px] rounded-full"
      type="button"
      data-dropdown-toggle="drop_down_profile"
    >
      {% if user.avatar%} {% if user.avatar|startswith:'https' %}
      <img
        class="h-[30px] w-[30px] rounded-full object-cover"
        src="{{user.avatar}}"
        alt="{{user.username}}"
      />
      {% else %}
      <img
        class="h-[30px] w-[30px] rounded-full object-cover"
        src="{{MEDIA_URL}}{{user.avatar}}"
        alt="{{ user.username}}"
      />
      {% endif %} {% else %}
      <div class="h-full w-full rounded-full bg-black"></div>
      {% endif %}
      <div
        class="relative bottom-2 left-6 h-[8px] w-[8px] rounded-full bg-green-400"
      ></div>
    </button>

    <div
      id="drop_down_profile"
      class="dark:bg-dark_6 z-10 hidden w-56 rounded-md bg-white shadow"
    >
      <ul
        class="divide-y divide-gray-400 px-3 pt-3 text-sm text-gray-700 dark:text-gray-200"
        aria-labelledby="btn_drop_down_profile"
      >
        <li class="h-10">
          <a
            href="{% url 'account:user_profile' user %}"
            class="flex flex-row items-center gap-2"
          >
            <div class="h-[30px] w-[30px] rounded-full">
              {% if user.avatar%} {% if user.avatar|startswith:'https' %}
              <img
                class="h-[30px] w-[30px] rounded-full object-cover"
                src="{{user.avatar}}"
                alt="{{user.username}}"
              />
              {% else %}
              <img
                class="h-[30px] w-[30px] rounded-full object-cover"
                src="{{MEDIA_URL}}{{user.avatar }}"
                alt="{{ user.username}}"
              />
              {% endif %} {% else %}
              <div class="h-full w-full rounded-full bg-black"></div>
              {% endif %}
              <div
                class="relative bottom-2 left-6 h-[8px] w-[8px] rounded-full bg-green-400"
              ></div>
            </div>

            <div class="flex flex-col justify-center text-[11px]">
              <p>View Profile</p>
              <p id = "username">u/{{ user.username }}</p>
            </div>
          </a>
        </li>
        <li class="h-10">
          <button
            id="theme-toggle"
            type="button"
            class="flex h-full w-full flex-row items-center justify-between"
          >
            <p>Theme</p>
            <svg
              id="theme-toggle-dark-icon"
              class="hidden h-5 w-5"
              fill="currentColor"
              viewBox="0 0 20 20"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
              ></path>
            </svg>
            <svg
              id="theme-toggle-light-icon"
              class="hidden h-5 w-5"
              fill="currentColor"
              viewBox="0 0 20 20"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
                fill-rule="evenodd"
                clip-rule="evenodd"
              ></path>
            </svg>
          </button>
        </li>
        <li class="h-10">
          <form
            method="POST"
            action="{% url 'account:logout' %}"
            class="flex h-full flex-row items-center gap-2"
          >
            {% csrf_token %}
            <button
              class="flex h-full flex-row items-center gap-2"
              method="post"
            >
              <svg
                fill="currentColor"
                height="20"
                icon-name="logout-outline"
                viewBox="0 0 20 20"
                width="20"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M11.991 10.625H1v-1.25h10.991l-1.933-1.933.884-.884 3 3a.624.624 0 0 1 0 .884l-3 3-.884-.884 1.933-1.933ZM15.375 1h-9.75A2.629 2.629 0 0 0 3 3.625v.792h1.25v-.792A1.377 1.377 0 0 1 5.625 2.25h9.75a1.377 1.377 0 0 1 1.375 1.375v12.75a1.377 1.377 0 0 1-1.375 1.375h-9.75a1.377 1.377 0 0 1-1.375-1.375v-.792H3v.792A2.63 2.63 0 0 0 5.625 19h9.75A2.63 2.63 0 0 0 18 16.375V3.625A2.63 2.63 0 0 0 15.375 1Z"
                ></path>
              </svg>
              <p>Logout</p>
            </button>
          </form>
        </li>
      </ul>
    </div>

    {% else %}
    <button
      data-modal-target="sign_in_modal"
      data-modal-toggle="sign_in_modal"
      class="font-md bg-button_red hover:bg-button_red_hover w-full rounded-2xl px-3 py-2 text-sm font-medium text-white transition-all duration-300 ease-in-out hover:text-white"
      type="button"
    >
      Log in
    </button>

    {% endif %}
  </div>
</nav>

{% if not request.user.is_authenticated %} {%include 'components/modals/sign_in_modal.html'%} {%include 'components/modals/sign_up_modal.html'%} {% endif %}

<script>
  function toggleProfileOptions() {
    var profileOptions = document.getElementById("profileOptions");
    if (profileOptions.classList.contains("hidden")) {
      profileOptions.classList.remove("hidden", "opacity-0");
      profileOptions.classList.add("block", "opacity-100");
    } else {
      profileOptions.classList.remove("block", "opacity-100");
      profileOptions.classList.add("hidden", "opacity-0");
    }
  }

  var themeToggleDarkIcon = document.getElementById("theme-toggle-dark-icon");
  var themeToggleLightIcon = document.getElementById("theme-toggle-light-icon");

  // Change the icons inside the button based on previous settings
  if (
    localStorage.getItem("color-theme") === "dark" ||
    (!("color-theme" in localStorage) &&
      window.matchMedia("(prefers-color-scheme: dark)").matches)
  ) {
    themeToggleDarkIcon.classList.remove("hidden");
  } else {
    themeToggleLightIcon.classList.remove("hidden");
  }

  var themeToggleBtn = document.getElementById("theme-toggle");

  themeToggleBtn.addEventListener("click", function () {
    // toggle icons inside button
    themeToggleDarkIcon.classList.toggle("hidden");
    themeToggleLightIcon.classList.toggle("hidden");
    // if set via local storage previously
    if (localStorage.getItem("color-theme")) {
      if (localStorage.getItem("color-theme") === "light") {
        document.documentElement.classList.add("dark");
        localStorage.setItem("color-theme", "dark");
      } else {
        document.documentElement.classList.remove("dark");
        localStorage.setItem("color-theme", "light");
      }

      // if NOT set via local storage previously
    } else {
      if (document.documentElement.classList.contains("dark")) {
        document.documentElement.classList.remove("dark");
        localStorage.setItem("color-theme", "light");
      } else {
        document.documentElement.classList.add("dark");
        localStorage.setItem("color-theme", "dark");
      }
    }
  });
</script>
